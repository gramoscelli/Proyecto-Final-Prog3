# API CRUD para Tasks - Guía de Implementación

## Estructura de archivos a crear:

```
backend/
├── controllers/
│   └── taskController.js
├── routes/
│   └── taskRoutes.js
├── middleware/
│   └── validation.js
└── routes/
    └── index.js (actualizar)
```

## Paso 1: Crear el controlador de tareas

**Archivo: `controllers/taskController.js`**

```javascript
const { Task } = require('../models');

// GET /api/tasks - Obtener todas las tareas
const getAllTasks = async (req, res) => {
  try {
    const { status, page = 1, limit = 10 } = req.query;
    
    const where = {};
    if (status) where.status = status;
    
    const offset = (page - 1) * limit;
    
    const { count, rows: tasks } = await Task.findAndCountAll({
      where,
      limit: parseInt(limit),
      offset: parseInt(offset),
      order: [['createdAt', 'DESC']]
    });
    
    res.json({
      tasks,
      pagination: {
        page: parseInt(page),
        limit: parseInt(limit),
        total: count,
        totalPages: Math.ceil(count / limit)
      }
    });
  } catch (error) {
    res.status(500).json({ error: 'Error fetching tasks', message: error.message });
  }
};

// GET /api/tasks/:id - Obtener tarea por ID
const getTaskById = async (req, res) => {
  try {
    const { id } = req.params;
    const task = await Task.findByPk(id);
    
    if (!task) {
      return res.status(404).json({ error: 'Task not found' });
    }
    
    res.json({ task });
  } catch (error) {
    res.status(500).json({ error: 'Error fetching task', message: error.message });
  }
};

// POST /api/tasks - Crear nueva tarea
const createTask = async (req, res) => {
  try {
    const { title, description, status } = req.body;
    
    const task = await Task.create({
      title,
      description,
      status: status || 'pending'
    });
    
    res.status(201).json({ 
      message: 'Task created successfully',
      task 
    });
  } catch (error) {
    res.status(400).json({ error: 'Error creating task', message: error.message });
  }
};

// PUT /api/tasks/:id - Actualizar tarea
const updateTask = async (req, res) => {
  try {
    const { id } = req.params;
    const { title, description, status } = req.body;
    
    const task = await Task.findByPk(id);
    if (!task) {
      return res.status(404).json({ error: 'Task not found' });
    }
    
    const updatedTask = await task.update({
      title: title || task.title,
      description: description !== undefined ? description : task.description,
      status: status || task.status
    });
    
    res.json({
      message: 'Task updated successfully',
      task: updatedTask
    });
  } catch (error) {
    res.status(400).json({ error: 'Error updating task', message: error.message });
  }
};

// DELETE /api/tasks/:id - Eliminar tarea
const deleteTask = async (req, res) => {
  try {
    const { id } = req.params;
    const task = await Task.findByPk(id);
    
    if (!task) {
      return res.status(404).json({ error: 'Task not found' });
    }
    
    await task.destroy();
    res.json({ message: 'Task deleted successfully' });
  } catch (error) {
    res.status(500).json({ error: 'Error deleting task', message: error.message });
  }
};

module.exports = {
  getAllTasks,
  getTaskById,
  createTask,
  updateTask,
  deleteTask
};
```

## Paso 2: Crear las rutas

**Archivo: `routes/taskRoutes.js`**

```javascript
const express = require('express');
const router = express.Router();
const {
  getAllTasks,
  getTaskById,
  createTask,
  updateTask,
  deleteTask
} = require('../controllers/taskController');

// GET /api/tasks - Obtener todas las tareas con filtros y paginación
router.get('/', getAllTasks);

// GET /api/tasks/:id - Obtener tarea por ID
router.get('/:id', getTaskById);

// POST /api/tasks - Crear nueva tarea
router.post('/', createTask);

// PUT /api/tasks/:id - Actualizar tarea
router.put('/:id', updateTask);

// DELETE /api/tasks/:id - Eliminar tarea
router.delete('/:id', deleteTask);

module.exports = router;
```

## Paso 3: Actualizar el archivo principal de rutas

**Archivo: `routes/index.js`** (actualizar)

```javascript
const express = require('express');
const router = express.Router();

// Importar rutas
const taskRoutes = require('./taskRoutes');

// Ruta de prueba
router.get('/health', (req, res) => {
  res.status(200).json({
    status: 'OK',
    message: 'API funcionando correctamente',
    timestamp: new Date().toISOString(),
    environment: process.env.NODE_ENV || 'development'
  });
});

// Rutas de tareas
router.use('/tasks', taskRoutes);

module.exports = router;
```

## Paso 4: Actualizar models/index.js

**Archivo: `models/index.js`** (agregar Task)

```javascript
// backend/models/index.js
const { Sequelize } = require('sequelize');
const config = require('../config/config');

const env = process.env.NODE_ENV || 'development';
const dbConfig = config[env];

const sequelize = new Sequelize(
  dbConfig.database,
  dbConfig.username,
  dbConfig.password,
  {
    host: dbConfig.host,
    port: dbConfig.port,
    dialect: dbConfig.dialect,
    logging: dbConfig.logging,
    pool: dbConfig.pool,
    dialectOptions: dbConfig.dialectOptions
  }
);

// Importar modelos
const Task = require('./task')(sequelize, Sequelize.DataTypes);

module.exports = {
  sequelize,
  Sequelize,
  Task
};
```

## Endpoints disponibles:

| Método | Endpoint | Descripción |
|--------|----------|-------------|
| GET | `/api/tasks` | Obtener todas las tareas (con filtros y paginación) |
| GET | `/api/tasks/:id` | Obtener tarea específica |
| POST | `/api/tasks` | Crear nueva tarea |
| PUT | `/api/tasks/:id` | Actualizar tarea |
| DELETE | `/api/tasks/:id` | Eliminar tarea |

## Parámetros de consulta disponibles:

- `status`: pending, in_progress, completed, cancelled
- `page`: número de página (default: 1)
- `limit`: elementos por página (default: 10, max: 100)

## Ejemplos de uso con curl:

```bash
# Obtener todas las tareas
curl -X GET http://localhost:3001/api/tasks

# Obtener tareas pendientes con paginación
curl -X GET "http://localhost:3001/api/tasks?status=pending&page=1&limit=5"

# Obtener tarea específica
curl -X GET http://localhost:3001/api/tasks/1

# Crear nueva tarea
curl -X POST http://localhost:3001/api/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Nueva tarea",
    "description": "Descripción de la tarea"
  }'

# Crear tarea mínima (solo título)
curl -X POST http://localhost:3001/api/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Tarea simple"
  }'

# Actualizar tarea completa
curl -X PUT http://localhost:3001/api/tasks/1 \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Tarea actualizada",
    "description": "Nueva descripción",
    "status": "in_progress"
  }'

# Marcar tarea como completada
curl -X PUT http://localhost:3001/api/tasks/1 \
  -H "Content-Type: application/json" \
  -d '{
    "status": "completed"
  }'

# Eliminar tarea
curl -X DELETE http://localhost:3001/api/tasks/1

# Probar endpoint de salud
curl -X GET http://localhost:3001/api/health
```